<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶…çº§ç®¡ç†åå° - ä»…ç®¡ç†å‘˜å¯è®¿é—®</title>
    <link rel="stylesheet" href="common.css">
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªï¼šç”¨æˆ·å+é€€å‡ºæŒ‰é’® -->
    <header class="admin-header">
        <h1>ç³»ç»Ÿè¶…çº§ç®¡ç†åå°</h1>
        <div class="user-info">
            æ¬¢è¿æ‚¨ï¼Œ<span id="current-username" class="username"></span>ï¼ˆè¶…çº§ç®¡ç†å‘˜ï¼‰
            <button class="logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
        </div>
    </header>

    <!-- æ ¸å¿ƒå†…å®¹åŒº -->
    <main class="content-container">
        <div class="function-card">
            <h3>ğŸ”§ ç®¡ç†å‘˜ä¸“å±åŠŸèƒ½</h3>
            <ul>
                <li>ä»£ç†è´¦å·ç®¡ç†ï¼ˆæ–°å¢/ä¿®æ”¹/åˆ é™¤ï¼‰</li>
                <li>ç³»ç»Ÿå…¨å±€è®¾ç½®</li>
                <li>æ‰€æœ‰ä»£ç†æ•°æ®æŸ¥çœ‹/ç»Ÿè®¡</li>
                <li>æ“ä½œæ—¥å¿—æŸ¥çœ‹</li>
            </ul>
        </div>
        <div class="function-card">
            <h3>ğŸ“‹ ä»£ç†è´¦å·åˆ—è¡¨ï¼ˆç‚¹å‡»åˆ·æ–°ï¼‰</h3>
            <button class="refresh-btn" onclick="getProxyList()">åˆ·æ–°ä»£ç†åˆ—è¡¨</button>
            <div id="proxy-list" class="proxy-list"></div>
        </div>
    </main>

    <script src="common.js"></script>
    <script>
        // é¡µé¢åŠ è½½å³æ ¡éªŒï¼š1.æ˜¯å¦ç™»å½• 2.æ˜¯å¦ä¸ºç®¡ç†å‘˜
        window.onload = async () => {
            await checkAdminAuth(); // ç®¡ç†å‘˜ä¸“å±æ ¡éªŒ
            initAutoLogout();       // åˆå§‹åŒ–æ— æ“ä½œè‡ªåŠ¨é€€å‡º
        };

        // å¯é€‰åŠŸèƒ½ï¼šè·å–æ‰€æœ‰ä»£ç†è´¦å·ï¼ˆä»…ç®¡ç†å‘˜å¯çœ‹ï¼‰
        async function getProxyList() {
            try {
                const res = await fetch(`${API_BASE}/get-proxies`, {
                    method: "GET",
                    credentials: "include"
                });
                const data = await res.json();
                if (data.success) {
                    const proxyList = document.getElementById("proxy-list");
                    proxyList.innerHTML = "";
                    for (let [account, info] of Object.entries(data.proxies)) {
                        proxyList.innerHTML += `<div class="proxy-item">è´¦å·ï¼š${account} | å¯†ç ï¼š${info.password}</div>`;
                    }
                    if (Object.keys(data.proxies).length === 0) {
                        proxyList.innerHTML = "<p>æš‚æ— ä»£ç†è´¦å·</p>";
                    }
                } else {
                    alert(data.message);
                }
            } catch (err) {
                console.error("è·å–ä»£ç†åˆ—è¡¨å¤±è´¥ï¼š", err);
                alert("è·å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡ï¼");
            }
        }
    </script>
</body>
</html>
